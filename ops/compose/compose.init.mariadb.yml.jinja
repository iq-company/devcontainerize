# Init service for MariaDB
# .env contains shared defaults, STAGE_ENV_FILE (set by CLI) contains stage-specific overrides

services:
  init:
    image: ${CUSTOM_IMAGE:-{{ image_prefix }}-release}:${CUSTOM_TAG:-latest}
    platform: linux/amd64
    env_file:
      - ../env/.env
      - ../env/${STAGE_ENV_FILE:-.env.dev}
    volumes:
      - sites:/home/{{ image_user }}/bench/sites
      - ../scripts/runtime:/home/{{ image_user }}/bench/bin-dev:ro
    entrypoint: /home/{{ image_user }}/bench/bin-dev/init_site.sh
    depends_on:
      db:
        condition: service_started
      redis-cache:
        condition: service_started
      redis-queue:
        condition: service_started
