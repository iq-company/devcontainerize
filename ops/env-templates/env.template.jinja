# =============================================================================
# STAGE-SPECIFIC ENVIRONMENT: {% raw %}{{stage}}{% endraw %}
# =============================================================================
# This file contains settings specific to the '{% raw %}{{stage}}{% endraw %}' stage.
# Values here override the shared .env file.
#
# Placeholders like {% raw %}{{random_lower}}{% endraw %} are replaced by init_env_files script.
# =============================================================================

# --- Project Identification (unique per stage) ---
COMPOSE_PROJECT_NAME={% raw %}{{random_lower}}{% endraw %}_{{ project_slug }}_{% raw %}{{stage}}{% endraw %}

# --- Init Mode ---
# Controls what the init service does on container start:
#   - migrate: Wait for services â†’ create site if not exists, else migrate
#   - wait: Wait for services only, no init/migrate (for existing deployments)
# Note: For dev/test/local stages, init_env_files sets this to "migrate" automatically
INIT_MODE=migrate

# --- Admin Password ---
IQ_ADMIN_PW={% raw %}{{random_password}}{% endraw %}

# --- Database Settings ---
DBMS={% raw %}{{dbms}}{% endraw %}

# Database host and port (service names or external)
DB_HOST={% raw %}{{db_host}}{% endraw %}
DB_PORT={% raw %}{{db_port}}{% endraw %}

# Super-user for DDL operations (schema creation, migrations)
# Used as fallback when DB_USER is empty (DDL mode)
DB_SUPER_USER={% raw %}{{db_super_user}}{% endraw %}
DB_SUPER_USER_PW={% raw %}{{db_super_user_pw}}{% endraw %}

# Root password for the database server
DB_ROOT_PASSWORD={% raw %}{{db_root_password}}{% endraw %}

# Database name
DB_NAME={{ project_slug }}_{% raw %}{{stage}}{% endraw %}_db

# Application database user
# Leave empty for DDL mode (uses DB_SUPER_USER for all operations)
# Set to a user name for restricted permissions (prod/staging)
# Note: For dev/test stages, init_env_files clears this automatically
DB_USER={{ project_slug }}_{% raw %}{{stage}}{% endraw %}_db
DB_PASSWORD={% raw %}{{db_password}}{% endraw %}

# --- Docker Image Settings ---
# Default (if not set): {{ image_prefix }}-release:latest (from Docker Compose fallback)
# Override only if needed:
# IQ_IMAGE={{ image_prefix }}-release
# IQ_IMAGE_TAG=latest
# For registry images (staging/prod):
# IQ_IMAGE=ghcr.io/your-org/your-app
# IQ_IMAGE_TAG=v1.0.0

# --- Optional: Override shared settings ---
# COMPOSE_PROFILES=ocr,webdb,monitoring  # Activate optional services for this stage
# WEBDB_PORT=22072
# NGINX_PORT=8011

# --- Optional: OpenID Connect Settings ---
# OPENID_REALM=iqa
# OPENID_BASE_URL=http://localhost:8081
# OPENID_CLIENT_ID={{ project_slug }}_{% raw %}{{stage}}{% endraw %}
# OPENID_CLIENT_SECRET=YOUR_SECRET_HERE
