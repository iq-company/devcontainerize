_min_copier_version: "9.0"
_templates_suffix: .jinja
_subdirectory: .

# Read `app_name` from calling cwd path
app_name:
  type: str
  default: "{{ copier_answers['_copier_conf']['project_path'] | path.basename }}"

project_name:
  type: str
  default: "My Awesome App Name"
  help: "Human-readable name of your project (used in README, etc.)"

project_slug:
  type: str
  default: "{{ app_name }}"
  help: "Slugified project name (used in docker image names and URLs)"

image_prefix:
  type: str
  default: "{{ project_slug }}"
  help: "Prefix for Docker image names"

default_dbms:
  type: str
  choices:
    - mariadb
    - postgres
    - sqlite
  default: postgres
  help: "Which DBMS should be used by default?"

frappe_branch:
  type: str
  default: "version-15"
  help: "Frappe branch name (e.g. 'version-15', 'develop')"

frappe_tag:
  type: str
  default: ""
  help: "Frappe tag (optional, overrides branch if set, e.g. 'v15.47.0')"

frappe_commit:
  type: str
  default: ""
  help: "Frappe commit SHA (optional, overrides branch/tag if set)"

# Computed: the actual git ref to use (commit > tag > branch)
frappe_ref:
  type: str
  default: "{% if frappe_commit %}{{ frappe_commit }}{% elif frappe_tag %}{{ frappe_tag }}{% else %}{{ frappe_branch }}{% endif %}"
  when: false  # Hidden, computed value

author_name:
  type: str
  default: "Author Name"
  help: "Name of the main author/maintainer"

image_user:
  type: str
  default: "frappe"
  help: "User name used inside the Docker image"

image_group:
  type: str
  default: "frappe"
  help: "Group name used inside the Docker image"

site_name:
  type: str
  default: "{{ app_name }}.local"
  help: "Default domain name used by the devcontainer site"

_tasks:
  - "python3 \"{{ _copier_conf.src_path }}/ops/copier/patch_commands_init_py.py\" {{ app_name }} \"{{ _copier_conf.src_path }}\""
  - "python3 \"{{ _copier_conf.src_path }}/ops/copier/patch_hooks_py.py\" {{ app_name }}"
  - "python3 \"{{ _copier_conf.src_path }}/ops/copier/update_feature_skips.py\" \"{{ _copier_conf.dst_path }}\" \"{{ _copier_conf.src_path }}/copier_features.yml\""
  - "python3 \"{{ _copier_conf.src_path }}/ops/copier/patch_pyproject_toml.py\" \"{{ _copier_conf.dst_path }}\" {{ feature_image_creation }}"
  - "python3 \"{{ _copier_conf.src_path }}/ops/copier/move_copier_answers.py\" \"{{ _copier_conf.dst_path }}\""
  - "python3 \"{{ _copier_conf.src_path }}/ops/copier/init_dev_stage.py\" \"{{ _copier_conf.dst_path }}\" {{ image_prefix }} {{ default_dbms }}"
  - "python3 \"{{ _copier_conf.src_path }}/ops/copier/gen_dockerfiles.py\" \"{{ _copier_conf.dst_path }}\""

_skip_if_exists:
  - "{{ app_name }}/commands/__init__.py"
  - "{{ app_name }}/ops_hooks.py"
  - ".devcontainer/launch.json"
  - ".vscode/tasks.json"
  - ".vscode/settings.json"
  - "ops/build/VERSION"
  - "ops/build/stages.yml"
  - "ops/build/resources/dev-cleaner-custom.sh"
  - "ops/build/resources/release-cleaner-custom.sh"
  - "ops/build/resources/frappe-patches.sh"
  - "ops/env-templates/env.template"
  - "ops/build/docker-templates/recipes/99-custom.yml"  # User's custom recipes
  - "pyproject.toml"

feature_devcontainer:
  type: bool
  default: true
  help: "Enable devcontainer support?"

feature_image_creation:
  type: bool
  default: true
  help: "Enable image creation support?"

feature_mkdocs:
  type: bool
  default: true
  when: "{{ feature_image_creation is true }}"
  help: "Enable mkdocs generation support?"

# feature_image_ops:
#   type: bool
#   default: true
#   when: "{{ feature_image_creation is true }}"
#   help: "Enable image operations support (e.g. baker settings compose files)?"

# feature_ci_gh_changelog:
#   type: bool
#   default: false
#   when: "{{ feature_image_creation and feature_image_ops is true }}"
#   help: "Enable github CI/CD changelog generation"

_exclude:
  - "**/.git"
  - "**/.git/**"
  - .gitignore
  - .gitattributes
  - .github/
  - ops/copier/
  - tests/
  - README.md
  - LICENSE
  - AGENT.md
  - copier.yaml
  - copier_features.yml
